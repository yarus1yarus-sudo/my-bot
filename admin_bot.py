import requests
import json
import os
import random

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
def load_config():
    try:
        with open('config.json', 'r', encoding='utf-8') as f:
            return json.load(f)
    except FileNotFoundError:
        # –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º –µ–≥–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        default_config = {
            'bot_enabled': True,
            'schedule': 'daily'
        }
        with open('config.json', 'w', encoding='utf-8') as f:
            json.dump(default_config, f, ensure_ascii=False, indent=2)
        return default_config
    except json.JSONDecodeError:
        print("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è config.json. –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.")
        return {'bot_enabled': True, 'schedule': 'daily'}

# –ö–õ–Æ–ß–ï–í–ê–Ø –ü–†–û–í–ï–†–ö–ê: –ß–∏—Ç–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ
config = load_config()
if not config.get('bot_enabled', False):
    print("üõë –ë–æ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –≤ config.json. –í—ã—Ö–æ–¥ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã.")
    exit()

print("‚úÖ –ë–æ—Ç –≤–∫–ª—é—á–µ–Ω. –ù–∞—á–∏–Ω–∞–µ–º —Ä–∞–±–æ—Ç—É...")

# –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN')
if not TOKEN:
    print("‚ùå –û—à–∏–±–∫–∞: TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    exit()

# ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
USER_ID = "6396018806"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–Ω–µ–∫–¥–æ—Ç–∞
def get_joke():
    jokes = [
        "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç —Ç—ë–º–Ω—É—é —Ç–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–≤–µ—Ç –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –±–∞–≥–∏! üêõ",
        "‚Äî –î–æ–∫—Ç–æ—Ä, —É –º–µ–Ω—è –ø–∞–º—è—Ç—å –∫–∞–∫ —É —Ä—ã–±–∫–∏! ‚Äî –ê —Å –∫–∞–∫–∏—Ö –ø–æ—Ä? ‚Äî –ö—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç? üê†",
        "–ñ–µ–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—É: ‚Äî –î–æ—Ä–æ–≥–æ–π, —Å—Ö–æ–¥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω –∑–∞ —Ö–ª–µ–±–æ–º, –∏ –µ—Å–ª–∏ –±—É–¥—É—Ç —è–π—Ü–∞ ‚Äî –∫—É–ø–∏ –¥—é–∂–∏–Ω—É. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç 12 –±–∞—Ç–æ–Ω–æ–≤ —Ö–ª–µ–±–∞. ü•ñ",
        "‚Äî –ü–æ—á–µ–º—É —É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –Ω–µ—Ç –¥–µ–≤—É—à–µ–∫? ‚Äî –ü–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –¥—É–º–∞—é—Ç, —á—Ç–æ 1 + 1 = 10! üíª",
        "–ò–¥—ë—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø–æ —É–ª–∏—Ü–µ –∏ –≤–∏–¥–∏—Ç –ª—è–≥—É—à–∫—É. –õ—è–≥—É—à–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç: ‚Äî –ü–æ—Ü–µ–ª—É–π –º–µ–Ω—è, –∏ —è —Å—Ç–∞–Ω—É –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–π –ø—Ä–∏–Ω—Ü–µ—Å—Å–æ–π! –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –±–µ—Ä—ë—Ç –ª—è–≥—É—à–∫—É –∏ –∫–ª–∞–¥—ë—Ç –≤ –∫–∞—Ä–º–∞–Ω. ‚Äî –ü–æ—á–µ–º—É —Ç—ã –º–µ–Ω—è –Ω–µ –ø–æ—Ü–µ–ª–æ–≤–∞–ª? ‚Äî –ê –∑–∞—á–µ–º –º–Ω–µ –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞? –ì–æ–≤–æ—Ä—è—â–∞—è –ª—è–≥—É—à–∫–∞ –∫—Ä—É—á–µ! üê∏",
        "‚Äî –ú–∞–º, –∞ —á—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–∫—É—Ä—Å–∏—è? ‚Äî –ò–¥–∏ —Å–ø—Ä–æ—Å–∏ —É –ø–∞–ø—ã. ‚Äî –ü–∞–ø, –∞ —á—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–∫—É—Ä—Å–∏—è? ‚Äî –ò–¥–∏ —Å–ø—Ä–æ—Å–∏ —É –º–∞–º—ã. üîÑ",
        "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –¥–æ–º–æ–π –≤ 3 —É—Ç—Ä–∞. –ñ–µ–Ω–∞: ‚Äî –¢—ã –≥–¥–µ –±—ã–ª?! ‚Äî –ù–∞ —Ä–∞–±–æ—Ç–µ, –æ—Ç–ª–∞–∂–∏–≤–∞–ª –±–∞–≥–∏. ‚Äî –ê —è —á—Ç–æ, –¥—É—Ä–∞? ‚Äî –ù–µ—Ç, —Ç—ã feature! ‚ú®",
        "–í—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –¥–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞: ‚Äî –ö–∞–∫ –¥–µ–ª–∞? ‚Äî –ö–∞–∫ –≤ –∞–¥—É! ‚Äî –¢–æ –µ—Å—Ç—å –∫–∞–∫? ‚Äî 0 –∏ 1! üòà",
        "‚Äî –î–æ–∫—Ç–æ—Ä, –ø–æ–º–æ–≥–∏—Ç–µ! –Ø –¥—É–º–∞—é, —á—Ç–æ —è –∫–æ–º–ø—å—é—Ç–µ—Ä! ‚Äî –•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ê –∫–∞–∫ –¥–∞–≤–Ω–æ —ç—Ç–æ –Ω–∞—á–∞–ª–æ—Å—å? ‚Äî –° –º–æ–º–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏... —Ç–æ –µ—Å—Ç—å —Ä–æ–∂–¥–µ–Ω–∏—è! üíæ",
        "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ª–æ–∂–∏—Ç—Å—è —Å–ø–∞—Ç—å. –ú–æ–∑–≥: ‚Äî –ê —Ç—ã —Ç–æ—á–Ω–æ –∑–∞–∫—Ä—ã–ª –≤—Å–µ —Å–∫–æ–±–∫–∏? –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –≤—Å—Ç–∞—ë—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–¥... üß†"
    ]
    return random.choice(jokes)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
def send_message(text):
    url = f"https://api.telegram.org/bot{TOKEN}/sendMessage"
    data = {
        'chat_id': USER_ID,
        'text': text,
        'parse_mode': 'HTML'
    }
    
    try:
        response = requests.post(url, data=data, timeout=10)
        response.raise_for_status()
        print(f"‚úÖ –ê–Ω–µ–∫–¥–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        return True
    except requests.exceptions.RequestException as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∞–Ω–µ–∫–¥–æ—Ç–∞: {e}")
        return False

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
if __name__ == "__main__":
    print("ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–µ–∫–¥–æ—Ç–∞...")
    
    # –ü–æ–ª—É—á–∞–µ–º –∞–Ω–µ–∫–¥–æ—Ç
    joke = get_joke()
    print(f"üìù –í—ã–±—Ä–∞–Ω –∞–Ω–µ–∫–¥–æ—Ç: {joke[:50]}...")
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞–Ω–µ–∫–¥–æ—Ç
    if send_message(f"üòÑ <b>–ê–Ω–µ–∫–¥–æ—Ç –¥–Ω—è:</b>\n\n{joke}"):
        print("üéâ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!")
    else:
        print("üí• –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞!")
